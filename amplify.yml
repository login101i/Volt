version: 1
frontend:
  phases:
    preBuild:
      commands:
        # Install frontend dependencies
        - cd frontend
        - npm ci --cache .npm --prefer-offline
    build:
      commands:
        # Build Next.js frontend
        # AWS Amplify automatycznie wykryje Next.js SSR i użyje odpowiedniej konfiguracji
        - NODE_OPTIONS=--max-old-space-size=4096 npm run build
  artifacts:
    # Dla Next.js SSR w monorepo: baseDirectory musi wskazywać na folder .next
    # Po cd frontend i npm run build, .next jest w frontend/.next
    # Amplify kopiuje artifacts z root repo, więc używamy pełnej ścieżki
    baseDirectory: frontend/.next
    files:
      - '**/*'
  cache:
    paths:
      - frontend/.next/cache/**/*
      - frontend/.npm/**/*
      - frontend/node_modules/**/*

